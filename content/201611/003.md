+++
title = "正しさについて考えさせられた"
draft = false
date = "2016-11-21T22:06:26+09:00"

+++

### ことのはじまり

職場で偉い人と雑談してる時に

> 世の中わりと適当でもやっていけるんだから、あまりカツカツするのもアレな感じでよくないのかもしれないねえ

という話がありました。

多分に共感できるところがあって「ですよね～」なんて相槌を打ってたらとあるソースコードを見せられまして……

### とあるソースコード

それはクライアントからソケットでデータを受け取ってゴニョゴニョするC言語で実装されたプログラムでした。

仕様は聞かずコードを眺めているとrecv(2)の返り値が期待値と異なっていた場合はロスト扱いするという実装です。

微妙な空白の時間が生まれました。

recvは確か受け取ったバイト数が返り値だから0になるか-1(error)になるまで呼び出さないといけなかったんじゃ…などと遠く消えそうな記憶を辿りよせるも心もとなかったので、偉い人に断りを入れてその場で[Man page of RECV](https://linuxjm.osdn.jp/html/LDP_man-pages/man2/recv.2.html)を確認しました。

> recv(), recvfrom(), recvmsg() コールは、 ソケットからメッセージを受け取るのに使用される。 これらはコネクションレス型のソケットにも接続指向

中略

> これらの三つのシステムコールはいずれも、成功した場合にはメッセージの長さを返す。

中略

> ソケットに受け取るメッセージが存在しなかった場合、 受信用のコールはメッセージが到着するまで待つ。

記憶は正しかったようです。

これで上手く動いているのか確認したところ、動いてはいるけどロストも多いそうだよとおっしゃっていました。

弊社のメンバーがこのようなコードを書いたのではと心配になり確認しましたが、開発元は他社で紆余曲折あり機能拡張を弊社が請け負ったそうです。この実装上の不備については請負の範疇外とのことでした。

### 正しさとは何か

ロストを許容するというのが仕様制限として謳われているため、ロストの原因を如何を問わず可視化された情報はロストなのです。これは仕様制限としているのだから問題ないということのようです。

正しさの定義は難しいのですが、実装として間違っているとしてもそれが正しかどうかを決めるのは別のレイヤにあるということです。この事例の場合、可視化される情報の価値が正しさを定義する尺度だと言い換えても良いでしょう。

### 技術者としてできること

前段で正しさを決めるのは実装と別のレイヤにあるのだと言いましたが、技術者として正しさとは何であるかと考えると上記のような実装は許容しがたいものがあります。
